<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <title>Sistema Contable</title>
  <!-- Quasar (CSS) -->
  <link href="./vendor/quasar.prod.css" rel="stylesheet">
    <!-- Iconos -->
    <link href="https://cdn.jsdelivr.net/npm/@quasar/extras/material-icons/material-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- Nota: Las librer√≠as JS (Vue/Quasar/Axios) se cargan al final del body para evitar errores de DOM -->
    <style>
      :root { --bg: #0f172a; --card: #111827; --accent: #06b6d4; }
      body { 
        background: linear-gradient(180deg, #0b1020 0%, #0f172a 100%); 
        font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        color: #e5e7eb;
      }
      .glass-card { 
        background: rgba(17, 24, 39, 0.75); 
        backdrop-filter: blur(10px); 
        border: 1px solid rgba(255,255,255,0.05); 
        border-radius: 16px; 
      }
      .soft { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
      
      /* Gradiente con soporte y fallback */
      .brand-grad {
        background: linear-gradient(135deg, #06b6d4 0%, #22d3ee 50%, #a78bfa 100%);
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
        -webkit-text-fill-color: transparent;
      }
      
      .q-header { 
        background: rgba(17, 24, 39, 0.7) !important; 
        backdrop-filter: blur(8px); 
        border-bottom: 1px solid rgba(255,255,255,0.06); 
      }
      .q-drawer { 
        background: rgba(17, 24, 39, 0.8); 
        backdrop-filter: blur(10px); 
      }
      
      /* Mejoras de visibilidad para inputs y tablas */
      .q-field--filled .q-field__control {
        background: rgba(30, 41, 59, 0.6) !important;
        color: #e5e7eb !important;
      }
      .q-field--filled .q-field__control:before {
        border-bottom: 1px solid rgba(255,255,255,0.2) !important;
      }
      .q-field--filled .q-field__control:hover:before {
        border-bottom: 1px solid rgba(6, 182, 212, 0.5) !important;
      }
      .q-field--filled.q-field--focused .q-field__control:before {
        border-bottom: 2px solid #06b6d4 !important;
      }
      .q-field__label, .q-field__native, .q-field__prefix {
        color: #d1d5db !important;
      }
      /* Tablas con mejor contraste */
      .q-table {
        background: rgba(15, 23, 42, 0.8) !important;
        color: #f3f4f6 !important;
      }
      .q-table thead tr, .q-table tbody td {
        border-color: rgba(255,255,255,0.15) !important;
      }
      .q-table th {
        color: #22d3ee !important;
        font-weight: 700 !important;
        background: rgba(6, 182, 212, 0.15) !important;
        font-size: 0.85rem !important;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .q-table tbody td {
        color: #e5e7eb !important;
        padding: 12px 16px !important;
      }
      .q-table tbody tr {
        border-bottom: 1px solid rgba(255,255,255,0.08) !important;
      }
      .q-table tbody tr:hover {
        background: rgba(6, 182, 212, 0.12) !important;
      }
      
      /* Cards y componentes oscuros */
      .q-card, .q-item {
        color: #e5e7eb !important;
      }
      .q-btn {
        font-weight: 600 !important;
      }
      
      /* Mejoras de separadores y bordes */
      .q-separator {
        background: rgba(255,255,255,0.1) !important;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <!-- Librer√≠as JS locales (orden importa) -->
    <script src="./vendor/vue.global.prod.js"></script>
    <script src="./vendor/quasar.umd.prod.js"></script>
    <script src="./vendor/axios.min.js"></script>

    <script>
      // Asegura que el DOM est√° listo antes de montar
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init)
      } else {
        init()
      }

      function init () {
      const { createApp, ref, reactive, onMounted } = Vue
      // En UMD, `Quasar` ya es global; s√≥lo extraemos composables
      const { useQuasar } = Quasar

      const App = {
        setup () {
          const $q = useQuasar()
          const leftDrawerOpen = ref(true)
          const page = ref('catalogo')
          const loading = ref(false)
          const error = ref(null)

          const catalogo = ref([])
          const diario = ref([])
          const ventas = ref([])
          const mayor = ref([])
          const balanza = ref(null)
          const balanceGeneral = ref(null)
          
          // Formularios reactivos (v-model)
          const formPartida = reactive({
            fecha: new Date().toISOString().slice(0,10),
            descripcion: '',
            cuenta_debe: '',
            cuenta_haber: '',
            monto: null
          })

          const formAjuste = reactive({
            fecha: new Date().toISOString().slice(0,10),
            descripcion: '',
            cuenta_debe: '',
            cuenta_haber: '',
            monto: null
          })

          const formFactura = reactive({
            cliente: '',
            nit: '',
            direccion: '',
            descripcion: '',
            cantidad: 1,
            precio_unitario: null,
            monto: null
          })

          const facturaPreview = ref(null)

          const fetchCatalogo = async () => {
            loading.value = true; error.value = null
            try {
              const { data } = await axios.get('/api/catalogo')
              catalogo.value = data
            } catch (e) { error.value = 'No se pudo cargar el cat√°logo' }
            finally { loading.value = false }
          }

          const fetchDiario = async () => {
            loading.value = true; error.value = null
            try {
              const { data } = await axios.get('/api/diario')
              diario.value = data
            } catch (e) { error.value = 'No se pudo cargar el diario' }
            finally { loading.value = false }
          }

          const fetchVentas = async () => {
            loading.value = true; error.value = null
            try {
              const { data } = await axios.get('/api/ventas')
              ventas.value = data
            } catch (e) { error.value = 'No se pudo cargar ventas' }
            finally { loading.value = false }
          }

          const fetchMayor = async () => {
            loading.value = true; error.value = null
            try {
              const { data } = await axios.get('/api/mayor')
              mayor.value = data
            } catch (e) { error.value = 'No se pudo cargar el mayor' }
            finally { loading.value = false }
          }

          const fetchBalanza = async () => {
            loading.value = true; error.value = null
            try {
              const { data } = await axios.get('/api/balanza')
              balanza.value = data
            } catch (e) { error.value = 'No se pudo cargar la balanza' }
            finally { loading.value = false }
          }

          const fetchBalanceGeneral = async () => {
            loading.value = true; error.value = null
            try {
              const { data } = await axios.get('/api/balance-general')
              balanceGeneral.value = data
            } catch (e) { error.value = 'No se pudo cargar el balance general' }
            finally { loading.value = false }
          }

          const registrarPartida = async () => {
            loading.value = true; error.value = null
            try {
              const payload = { ...formPartida }
              await axios.post('/api/partida', payload)
              $q.notify({ type: 'positive', message: 'Partida registrada' })
              // reset parcial
              formPartida.descripcion = ''
              formPartida.cuenta_debe = ''
              formPartida.cuenta_haber = ''
              formPartida.monto = null
              fetchDiario()
            } catch (e) { error.value = 'No se pudo registrar la partida' }
            finally { loading.value = false }
          }

          const crearFactura = async() => {
            loading.value = true; error.value = null
            try {
              const monto = (formFactura.cantidad || 1) * (formFactura.precio_unitario || 0)
              const payload = { 
                ...formFactura,
                monto: monto
              }
              const { data } = await axios.post('/api/factura', payload)
              $q.notify({ type: 'positive', message: 'Factura creada exitosamente' })
              
              // Mostrar preview de la factura
              facturaPreview.value = {
                ...payload,
                id: data.id || 'DRAFT',
                fecha: new Date().toLocaleDateString('es-SV')
              }
              
              // Reset form
              formFactura.cliente = ''
              formFactura.nit = ''
              formFactura.direccion = ''
              formFactura.descripcion = ''
              formFactura.cantidad = 1
              formFactura.precio_unitario = null
              formFactura.monto = null
              
              fetchVentas()
            } catch (e) { 
              error.value = 'No se pudo crear la factura'
              $q.notify({ type: 'negative', message: error.value })
            }
            finally { loading.value = false }
          }

          const imprimirFactura = () => {
            const printContent = document.getElementById('factura-preview')
            if (printContent) {
              const printWindow = window.open('', '', 'height=600,width=800')
              printWindow.document.write('<html><head><title>Factura</title>')
              printWindow.document.write('<style>body{font-family:Arial,sans-serif;padding:20px;}</style>')
              printWindow.document.write('</head><body>')
              printWindow.document.write(printContent.innerHTML)
              printWindow.document.write('</body></html>')
              printWindow.document.close()
              printWindow.print()
            }
          }

          const registrarAjuste = async () => {
            loading.value = true; error.value = null
            try {
              const payload = { ...formAjuste }
              await axios.post('/api/partida-ajuste', payload)
              $q.notify({ type: 'positive', message: 'Partida de ajuste registrada' })
              formAjuste.descripcion = ''
              formAjuste.cuenta_debe = ''
              formAjuste.cuenta_haber = ''
              formAjuste.monto = null
              fetchDiario()
            } catch (e) { error.value = 'No se pudo registrar el ajuste' }
            finally { loading.value = false }
          }

          onMounted(() => {
            fetchCatalogo(); fetchDiario(); fetchVentas(); fetchMayor(); fetchBalanza(); fetchBalanceGeneral()
          })

          return { 
            leftDrawerOpen, page, loading, error, 
            catalogo, diario, ventas, mayor, balanza, balanceGeneral,
            formPartida, formAjuste, formFactura, facturaPreview,
            registrarPartida, registrarAjuste, crearFactura, imprimirFactura,
            fetchCatalogo, fetchDiario, fetchVentas, fetchMayor, fetchBalanza, fetchBalanceGeneral 
          }
        },
        template: `
          <q-layout view="lHh Lpr lFf">
            <q-header elevated class="q-px-md">
              <q-toolbar>
                <q-btn flat dense round icon="menu" @click="leftDrawerOpen = !leftDrawerOpen" />
                <q-toolbar-title>
                  <span class="brand-grad">Sistema Contable</span>
                </q-toolbar-title>
                <q-btn dense flat icon="refresh" @click="fetchCatalogo(); fetchDiario(); fetchVentas()" />
              </q-toolbar>
            </q-header>

            <q-drawer v-model="leftDrawerOpen" show-if-above bordered>
              <q-list padding>
                <q-item clickable v-ripple @click="page = 'catalogo'">
                  <q-item-section avatar><q-icon name="list" /></q-item-section>
                  <q-item-section>1. Cat√°logo de Cuentas</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'manual'">
                  <q-item-section avatar><q-icon name="menu_book" /></q-item-section>
                  <q-item-section>2. Manual de Cuentas</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'diario'">
                  <q-item-section avatar><q-icon name="book" /></q-item-section>
                  <q-item-section>3. Libro Diario</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'mayor'">
                  <q-item-section avatar><q-icon name="account_balance_wallet" /></q-item-section>
                  <q-item-section>4. Mayorizaci√≥n</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'ajustes'">
                  <q-item-section avatar><q-icon name="tune" /></q-item-section>
                  <q-item-section>5. Partidas de Ajuste</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'balanza'">
                  <q-item-section avatar><q-icon name="balance" /></q-item-section>
                  <q-item-section>6. Balanza de Comprobaci√≥n</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'balance-inicial'">
                  <q-item-section avatar><q-icon name="account_balance" /></q-item-section>
                  <q-item-section>7. Balance Inicial</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'estados-financieros'">
                  <q-item-section avatar><q-icon name="assessment" /></q-item-section>
                  <q-item-section>8. Estados Financieros</q-item-section>
                </q-item>
                <q-separator class="q-my-sm" />
                <q-item clickable v-ripple @click="page = 'facturacion'">
                  <q-item-section avatar><q-icon name="receipt_long" /></q-item-section>
                  <q-item-section>9. Facturaci√≥n Digital</q-item-section>
                </q-item>
                <q-item clickable v-ripple @click="page = 'ventas'">
                  <q-item-section avatar><q-icon name="analytics" /></q-item-section>
                  <q-item-section>Reporte de Ventas</q-item-section>
                </q-item>
              </q-list>
            </q-drawer>

            <q-page-container>
              <q-page padding>
                <div class="row q-col-gutter-md">
                  <div class="col-12">
                    <q-banner v-if="error" rounded class="bg-red-9 text-white q-mb-md">
                      {{ error }}
                    </q-banner>
                  </div>

                  <div class="col-12" v-show="page === 'catalogo'">
                    <div class="glass-card soft q-pa-md">
                      <div class="row items-center q-mb-sm">
                        <div class="col">
                          <div class="text-h6">Cat√°logo de cuentas</div>
                          <div class="text-subtitle2 text-grey-5">Estructura y tipos de cuentas</div>
                        </div>
                        <q-btn flat color="white" icon="refresh" @click="fetchCatalogo" />
                      </div>
                      <q-table dense flat separator="horizontal" :rows="catalogo" :columns="[
                        { name: 'codigo', label: 'C√≥digo', field: 'codigo', sortable: true },
                        { name: 'nombre', label: 'Nombre', field: 'nombre', sortable: true },
                        { name: 'tipo', label: 'Tipo', field: 'tipo', sortable: true },
                        { name: 'nivel', label: 'Nivel', field: 'nivel', sortable: true }
                      ]" row-key="codigo" :loading="loading" />
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'manual'">
                    <div class="glass-card soft q-pa-md">
                      <div class="text-h5 q-mb-md brand-grad">üìñ Manual de Cuentas</div>
                      <div class="text-subtitle1 text-grey-4 q-mb-lg">Descripci√≥n y uso de cada cuenta contable</div>
                      
                      <q-list separator>
                        <q-item v-for="cuenta in catalogo" :key="cuenta.codigo" class="q-pa-md">
                          <q-item-section>
                            <q-item-label class="text-h6 text-cyan">{{ cuenta.codigo }} - {{ cuenta.nombre }}</q-item-label>
                            <q-item-label caption class="q-mt-sm text-grey-4">
                              <strong>Tipo:</strong> {{ cuenta.tipo }} | <strong>Nivel:</strong> {{ cuenta.nivel }}
                            </q-item-label>
                            <q-item-label class="q-mt-sm text-grey-3">
                              <template v-if="cuenta.codigo === '1.1.1'">
                                <strong>Uso:</strong> Controla el efectivo disponible en caja. Se debita al recibir dinero y se acredita al realizar pagos en efectivo.
                              </template>
                              <template v-else-if="cuenta.codigo === '1.1.2'">
                                <strong>Uso:</strong> Registra los saldos en cuentas bancarias. Aumenta con dep√≥sitos y disminuye con cheques o transferencias.
                              </template>
                              <template v-else-if="cuenta.codigo === '1.1.3'">
                                <strong>Uso:</strong> Cuentas por cobrar a clientes por ventas a cr√©dito. Se debita al generar la venta y se acredita al cobrar.
                              </template>
                              <template v-else-if="cuenta.codigo === '2.1.1'">
                                <strong>Uso:</strong> Cuentas por pagar a proveedores por compras a cr√©dito. Se acredita al registrar la compra y se debita al pagar.
                              </template>
                              <template v-else-if="cuenta.codigo === '4.1'">
                                <strong>Uso:</strong> Ingresos por ventas de productos o servicios. Se acredita al generar una venta.
                              </template>
                              <template v-else-if="cuenta.codigo === '5.1'">
                                <strong>Uso:</strong> Gastos operativos administrativos. Se debita al incurrir en gastos de operaci√≥n.
                              </template>
                              <template v-else>
                                <strong>Uso:</strong> Cuenta de tipo {{ cuenta.tipo }} de nivel {{ cuenta.nivel }}. Consulta con el contador para su uso espec√≠fico.
                              </template>
                            </q-item-label>
                          </q-item-section>
                        </q-item>
                      </q-list>
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'diario'">
                    <div class="glass-card soft q-pa-md q-mb-md">
                      <div class="text-subtitle1 q-mb-sm">Nueva partida</div>
                      <q-form @submit.prevent="registrarPartida">
                        <q-input v-model="formPartida.fecha" filled label="Fecha (YYYY-MM-DD)" readonly class="q-mb-sm" />
                        <q-input v-model="formPartida.descripcion" filled label="Descripci√≥n" class="q-mb-sm" />
                        <div class="row q-col-gutter-sm">
                          <div class="col-12 col-md-6"><q-input v-model="formPartida.cuenta_debe" filled label="Cuenta Debe (ej: 1.1.1)" /></div>
                          <div class="col-12 col-md-6"><q-input v-model="formPartida.cuenta_haber" filled label="Cuenta Haber (ej: 4.1)" /></div>
                        </div>
                        <q-input v-model.number="formPartida.monto" filled label="Monto" type="number" prefix="$" class="q-mt-sm" />
                        <div class="q-mt-md"><q-btn color="primary" label="Registrar" type="submit" :loading="loading" /></div>
                      </q-form>
                    </div>
                    <div class="glass-card soft q-pa-md">
                      <div class="row items-center q-mb-sm">
                        <div class="col">
                          <div class="text-h6">Libro Diario</div>
                          <div class="text-subtitle2 text-grey-5">Partidas registradas</div>
                        </div>
                        <q-btn flat color="white" icon="refresh" @click="fetchDiario" />
                      </div>
                      <q-table flat dense :rows="diario" row-key="id" :columns="[
                        { name:'fecha', label:'Fecha', field:'fecha', sortable:true },
                        { name:'descripcion', label:'Descripci√≥n', field:'descripcion' },
                        { name:'cuenta_debe', label:'Debe', field:'cuenta_debe' },
                        { name:'cuenta_haber', label:'Haber', field:'cuenta_haber' },
                        { name:'monto', label:'Monto', field:'monto', format: (v)=>'$'+Number(v).toFixed(2), align:'right' }
                      ]" />
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'mayor'">
                    <div class="glass-card soft q-pa-md">
                      <div class="row items-center q-mb-sm">
                        <div class="col">
                          <div class="text-h6">üìä Libro Mayor</div>
                          <div class="text-subtitle2 text-grey-5">Saldos de debe y haber por cuenta</div>
                        </div>
                        <q-btn flat color="white" icon="refresh" @click="fetchMayor" />
                      </div>
                      <q-table flat dense :rows="mayor" row-key="cuenta" :columns="[
                        { name:'cuenta', label:'Cuenta', field:'cuenta', sortable:true, align:'left' },
                        { name:'debe', label:'Debe', field:'debe', format:(v)=>'$'+Number(v).toFixed(2), align:'right' },
                        { name:'haber', label:'Haber', field:'haber', format:(v)=>'$'+Number(v).toFixed(2), align:'right' },
                        { name:'saldo', label:'Saldo', field:'saldo', format:(v)=>'$'+Number(v).toFixed(2), align:'right' }
                      ]" :loading="loading" />
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'ajustes'">
                    <div class="glass-card soft q-pa-md q-mb-md">
                      <div class="text-h6 q-mb-md">‚öôÔ∏è Nueva Partida de Ajuste</div>
                      <q-form @submit.prevent="registrarAjuste">
                        <q-input v-model="formAjuste.fecha" filled label="Fecha (YYYY-MM-DD)" readonly class="q-mb-sm" />
                        <q-input v-model="formAjuste.descripcion" filled label="Descripci√≥n del ajuste" class="q-mb-sm" />
                        <div class="row q-col-gutter-sm">
                          <div class="col-12 col-md-6"><q-input v-model="formAjuste.cuenta_debe" filled label="Cuenta Debe" /></div>
                          <div class="col-12 col-md-6"><q-input v-model="formAjuste.cuenta_haber" filled label="Cuenta Haber" /></div>
                        </div>
                        <q-input v-model.number="formAjuste.monto" filled label="Monto" type="number" prefix="$" class="q-mt-sm" />
                        <div class="q-mt-md"><q-btn color="orange" label="Registrar Ajuste" type="submit" :loading="loading" /></div>
                      </q-form>
                    </div>
                    <div class="glass-card soft q-pa-md">
                      <div class="text-subtitle1 q-mb-sm">Partidas de ajuste registradas</div>
                      <q-table flat dense :rows="diario.filter(p => p.tipo === 'ajuste')" row-key="id" :columns="[
                        { name:'fecha', label:'Fecha', field:'fecha', sortable:true },
                        { name:'descripcion', label:'Descripci√≥n', field:'descripcion' },
                        { name:'cuenta_debe', label:'Debe', field:'cuenta_debe' },
                        { name:'cuenta_haber', label:'Haber', field:'cuenta_haber' },
                        { name:'monto', label:'Monto', field:'monto', format:(v)=>'$'+Number(v).toFixed(2), align:'right' }
                      ]" />
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'balanza'">
                    <div class="glass-card soft q-pa-md">
                      <div class="row items-center q-mb-md">
                        <div class="col">
                          <div class="text-h5">‚öñÔ∏è Balanza de Comprobaci√≥n</div>
                          <div class="text-subtitle2 text-grey-5">Verificaci√≥n de sumas y saldos</div>
                        </div>
                        <q-btn flat color="white" icon="refresh" @click="fetchBalanza" />
                      </div>
                      <q-table v-if="balanza" flat dense :rows="balanza.cuentas" row-key="cuenta" :columns="[
                        { name:'cuenta', label:'Cuenta', field:'cuenta', sortable:true, align:'left' },
                        { name:'debe', label:'Debe', field:'debe', format:(v)=>'$'+Number(v).toFixed(2), align:'right' },
                        { name:'haber', label:'Haber', field:'haber', format:(v)=>'$'+Number(v).toFixed(2), align:'right' },
                        { name:'saldo', label:'Saldo', field:'saldo', format:(v)=>'$'+Number(v).toFixed(2), align:'right' }
                      ]" :loading="loading">
                        <template v-slot:bottom>
                          <div class="full-width q-pa-md" style="background: rgba(6, 182, 212, 0.1); border-top: 2px solid #06b6d4;">
                            <div class="row q-gutter-md text-h6">
                              <div class="col text-right">Total Debe: <span class="text-cyan">\${{ balanza.totales.debe.toFixed(2) }}</span></div>
                              <div class="col text-right">Total Haber: <span class="text-cyan">\${{ balanza.totales.haber.toFixed(2) }}</span></div>
                              <div class="col text-right">
                                Diferencia: 
                                <span :class="balanza.totales.diferencia === 0 ? 'text-green' : 'text-red'">
                                  \${{ balanza.totales.diferencia.toFixed(2) }}
                                </span>
                              </div>
                            </div>
                            <div v-if="balanza.totales.diferencia === 0" class="text-center q-mt-sm text-green text-weight-bold">
                              ‚úì La balanza est√° cuadrada
                            </div>
                          </div>
                        </template>
                      </q-table>
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'balance-inicial'">
                    <div class="glass-card soft q-pa-md">
                      <div class="text-h5 q-mb-md">üèõÔ∏è Balance Inicial</div>
                      <div class="text-subtitle1 text-grey-4 q-mb-lg">Situaci√≥n patrimonial al inicio del periodo</div>
                      <div v-if="balanceGeneral" class="row q-col-gutter-md">
                        <div class="col-12 col-md-6">
                          <q-card flat bordered style="background: rgba(34, 211, 238, 0.05); border-color: #22d3ee;">
                            <q-card-section>
                              <div class="text-h6 text-cyan">ACTIVOS</div>
                              <div class="text-h4 q-mt-md">\${{ balanceGeneral.activos.toFixed(2) }}</div>
                            </q-card-section>
                          </q-card>
                        </div>
                        <div class="col-12 col-md-6">
                          <q-card flat bordered style="background: rgba(251, 146, 60, 0.05); border-color: #fb923c;">
                            <q-card-section>
                              <div class="text-h6" style="color: #fb923c;">PASIVOS</div>
                              <div class="text-h4 q-mt-md">\${{ balanceGeneral.pasivos.toFixed(2) }}</div>
                            </q-card-section>
                          </q-card>
                        </div>
                        <div class="col-12">
                          <q-card flat bordered style="background: rgba(168, 85, 247, 0.05); border-color: #a855f7;">
                            <q-card-section>
                              <div class="text-h6" style="color: #a855f7;">CAPITAL</div>
                              <div class="text-h4 q-mt-md">\${{ balanceGeneral.capital.toFixed(2) }}</div>
                            </q-card-section>
                          </q-card>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'estados-financieros'">
                    <div class="glass-card soft q-pa-md q-mb-md">
                      <div class="text-h5 q-mb-md brand-grad">üìà Balance General</div>
                      <div v-if="balanceGeneral" class="q-gutter-md">
                        <div class="row q-col-gutter-md">
                          <div class="col-12 col-md-6">
                            <div class="text-subtitle1 text-cyan q-mb-sm">ACTIVOS</div>
                            <div class="text-h4">\${{ balanceGeneral.activos.toFixed(2) }}</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="text-subtitle1 q-mb-sm" style="color: #fb923c;">PASIVOS + CAPITAL</div>
                            <div class="text-h4">\${{ (balanceGeneral.pasivos + balanceGeneral.capital).toFixed(2) }}</div>
                          </div>
                        </div>
                        <q-separator class="q-my-md" />
                        <div class="text-center">
                          <q-chip :color="balanceGeneral.ecuacion ? 'green' : 'red'" text-color="white" icon="check_circle">
                            {{ balanceGeneral.ecuacion ? 'Balance cuadrado ‚úì' : 'Balance descuadrado ‚úó' }}
                          </q-chip>
                        </div>
                      </div>
                    </div>

                    <div class="glass-card soft q-pa-md">
                      <div class="text-h5 q-mb-md brand-grad">üí∞ Estado de Resultados (P√©rdidas y Ganancias)</div>
                      <div v-if="balanceGeneral" class="q-gutter-md">
                        <div class="row q-col-gutter-md">
                          <div class="col-12 col-md-6">
                            <q-card flat bordered style="background: rgba(34, 197, 94, 0.1); border-color: #22c55e;">
                              <q-card-section>
                                <div class="text-subtitle1 text-green">INGRESOS</div>
                                <div class="text-h5 q-mt-sm">\${{ balanceGeneral.ingresos.toFixed(2) }}</div>
                              </q-card-section>
                            </q-card>
                          </div>
                          <div class="col-12 col-md-6">
                            <q-card flat bordered style="background: rgba(239, 68, 68, 0.1); border-color: #ef4444;">
                              <q-card-section>
                                <div class="text-subtitle1 text-red">GASTOS</div>
                                <div class="text-h5 q-mt-sm">\${{ balanceGeneral.gastos.toFixed(2) }}</div>
                              </q-card-section>
                            </q-card>
                          </div>
                        </div>
                        <q-separator class="q-my-md" />
                        <div class="text-center">
                          <div class="text-h6 text-grey-4">UTILIDAD / P√âRDIDA DEL EJERCICIO</div>
                          <div class="text-h3 q-mt-sm" :class="balanceGeneral.utilidad >= 0 ? 'text-green' : 'text-red'">
                            \${{ balanceGeneral.utilidad.toFixed(2) }}
                          </div>
                          <div class="text-subtitle2 q-mt-sm" :class="balanceGeneral.utilidad >= 0 ? 'text-green' : 'text-red'">
                            {{ balanceGeneral.utilidad >= 0 ? 'üìà Utilidad' : 'üìâ P√©rdida' }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'facturacion'">
                    <div class="glass-card soft q-pa-md q-mb-md">
                      <div class="text-h6 q-mb-md">üìÑ Nueva Factura Digital</div>
                      <q-form @submit.prevent="crearFactura">
                        <div class="row q-col-gutter-sm">
                          <div class="col-12 col-md-6">
                            <q-input v-model="formFactura.cliente" filled label="Nombre del Cliente" dense />
                          </div>
                          <div class="col-12 col-md-6">
                            <q-input v-model="formFactura.nit" filled label="NIT/DUI" dense />
                          </div>
                          <div class="col-12">
                            <q-input v-model="formFactura.direccion" filled label="Direcci√≥n" dense />
                          </div>
                          <div class="col-12">
                            <q-input v-model="formFactura.descripcion" filled label="Descripci√≥n del Servicio/Producto" type="textarea" rows="2" />
                          </div>
                          <div class="col-12 col-md-4">
                            <q-input v-model.number="formFactura.cantidad" filled label="Cantidad" type="number" dense />
                          </div>
                          <div class="col-12 col-md-4">
                            <q-input v-model.number="formFactura.precio_unitario" filled label="Precio Unitario" type="number" prefix="$" step="0.01" dense />
                          </div>
                          <div class="col-12 col-md-4">
                            <q-input readonly filled :model-value="((formFactura.cantidad || 0) * (formFactura.precio_unitario || 0)).toFixed(2)" label="Total" prefix="$" dense class="bg-cyan-10" />
                          </div>
                        </div>
                        <div class="q-mt-md">
                          <q-btn color="cyan" label="Generar Factura" icon="receipt" type="submit" :loading="loading" />
                        </div>
                      </q-form>
                    </div>

                    <!-- Vista previa de factura -->
                    <div v-if="facturaPreview" class="glass-card soft q-pa-lg" id="factura-preview" style="background: white; color: #1e293b;">
                      <div class="row items-center q-mb-md">
                        <div class="col">
                          <div class="text-h4 text-cyan-8 text-weight-bold">FACTURA</div>
                          <div class="text-subtitle2 text-grey-7">Sistema Contable Digital</div>
                        </div>
                        <div class="col-auto text-right">
                          <div class="text-caption text-grey-7">No. Factura</div>
                          <div class="text-h6 text-weight-bold">{{ facturaPreview.id || 'DRAFT' }}</div>
                          <div class="text-caption text-grey-7 q-mt-sm">{{ facturaPreview.fecha }}</div>
                        </div>
                      </div>
                      <q-separator class="q-my-md" color="cyan-8" />
                      <div class="row q-col-gutter-md q-mb-md">
                        <div class="col-12 col-md-6">
                          <div class="text-weight-bold text-cyan-8 q-mb-xs">FACTURADO A:</div>
                          <div>{{ facturaPreview.cliente }}</div>
                          <div class="text-caption">NIT/DUI: {{ facturaPreview.nit || 'N/A' }}</div>
                          <div class="text-caption">{{ facturaPreview.direccion || 'Sin direcci√≥n' }}</div>
                        </div>
                        <div class="col-12 col-md-6">
                          <div class="text-weight-bold text-cyan-8 q-mb-xs">DATOS DE LA EMPRESA:</div>
                          <div>Sistema Contable S.A. de C.V.</div>
                          <div class="text-caption">NIT: 0000-000000-000-0</div>
                          <div class="text-caption">Tel: (503) 0000-0000</div>
                        </div>
                      </div>
                      <q-separator class="q-my-md" />
                      <table style="width: 100%; border-collapse: collapse; color: #1e293b;">
                        <thead style="background: #06b6d4; color: white;">
                          <tr>
                            <th style="padding: 8px; text-align: left; border: 1px solid #0891b2;">Descripci√≥n</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #0891b2;">Cantidad</th>
                            <th style="padding: 8px; text-align: right; border: 1px solid #0891b2;">Precio Unit.</th>
                            <th style="padding: 8px; text-align: right; border: 1px solid #0891b2;">Total</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td style="padding: 8px; border: 1px solid #cbd5e1;">{{ facturaPreview.descripcion }}</td>
                            <td style="padding: 8px; text-align: center; border: 1px solid #cbd5e1;">{{ facturaPreview.cantidad || 1 }}</td>
                            <td style="padding: 8px; text-align: right; border: 1px solid #cbd5e1;">\${{ (facturaPreview.precio_unitario || facturaPreview.monto).toFixed(2) }}</td>
                            <td style="padding: 8px; text-align: right; border: 1px solid #cbd5e1; font-weight: bold;">\${{ facturaPreview.monto.toFixed(2) }}</td>
                          </tr>
                        </tbody>
                      </table>
                      <div class="row justify-end q-mt-md">
                        <div class="col-12 col-md-4" style="background: #ecfeff; padding: 12px; border-radius: 4px; border: 2px solid #06b6d4;">
                          <div class="row items-center justify-between q-mb-xs">
                            <div class="text-grey-8">Subtotal:</div>
                            <div>\${{ facturaPreview.monto.toFixed(2) }}</div>
                          </div>
                          <div class="row items-center justify-between q-mb-xs">
                            <div class="text-grey-8">IVA (13%):</div>
                            <div>\${{ (facturaPreview.monto * 0.13).toFixed(2) }}</div>
                          </div>
                          <q-separator class="q-my-xs" />
                          <div class="row items-center justify-between">
                            <div class="text-weight-bold text-h6 text-cyan-8">TOTAL:</div>
                            <div class="text-weight-bold text-h6 text-cyan-8">\${{ (facturaPreview.monto * 1.13).toFixed(2) }}</div>
                          </div>
                        </div>
                      </div>
                      <div class="q-mt-lg text-center text-caption text-grey-6">
                        Gracias por su compra - Documento generado digitalmente
                      </div>
                      <div class="q-mt-md text-center">
                        <q-btn outline color="cyan-8" label="Imprimir Factura" icon="print" @click="imprimirFactura" />
                      </div>
                    </div>
                  </div>

                  <div class="col-12" v-show="page === 'ventas'">
                    <div class="glass-card soft q-pa-md">
                      <div class="row items-center q-mb-sm">
                        <div class="col">
                          <div class="text-h6">Ventas del d√≠a</div>
                          <div class="text-subtitle2 text-grey-5">Hist√≥rico de facturaci√≥n</div>
                        </div>
                        <q-btn flat color="white" icon="refresh" @click="fetchVentas" />
                      </div>
                      <q-table flat dense :rows="ventas" row-key="id" :columns="[
                        { name:'fecha', label:'Fecha', field:'fecha', sortable:true },
                        { name:'cliente', label:'Cliente', field:'cliente' },
                        { name:'descripcion', label:'Descripci√≥n', field:'descripcion' },
                        { name:'monto', label:'Monto', field:'monto', align:'right', format:(v)=>'$'+Number(v).toFixed(2) }
                      ]" />
                    </div>
                  </div>
                </div>
              </q-page>
            </q-page-container>
          </q-layout>
        `
      }

      createApp(App).use(Quasar, { 
        config: { 
          brand: { primary: '#06b6d4' },
          dark: true  // Habilitar modo oscuro global
        } 
      }).mount('#app')
      }
    </script>
  </body>
  </html>
